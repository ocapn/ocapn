# August 2025 OCapN pre-standardization meeting, 2025-08-12

- **Chair**: Jonathan Rees
- **Scribe**: Erik Marks
- **Present**:
  - Jonathan A. Rees (Independent/Chair)
  - Christine Lemmer-Webber (Spritely)
  - Jessica Tallon (Spritely)
  - Juliana Sims (Spritely)
  - Baldur (indepenant)
  - Richard Gibson (Agoric)
  - Erik Marks (MetaMask)
  - Kris Kowal (Agoric/DCF)
  - Mark S. Miller (Agoric/DCF)

## Agenda

- [#190](https://github.com/ocapn/ocapn/pull/190): Unix Domain Socket Netlayer
- [#168](https://github.com/ocapn/ocapn/issues/168): desc:import-answer issue/PR
- [#183](https://github.com/ocapn/ocapn/issues/183): Perimeter types / Protocol extension

# Minutes

(Discussion of meeting hosting platform due to issue with bbb.softwareconservancy.org)

- Kris: I propose moving to an Agoric zoom link and vending it out for every meeting

- Baldur: May not work on mobile

- Christine: I propose Kris and Baldur try it out ahead of time

- Baldur: Agreed

## [#190](https://github.com/ocapn/ocapn/pull/190) Unix domain socket netlayer

JessicaTallon: Unix domain socket for multiple processes on the same machine, i.e. a low-latency netlayer to allow ocapn instances to communicate. This started as a Nelnet grant that Julie was working on getting the shepherd to use Goblins and OCapN. The shepherd is a service manager for nix-like systems. There are multiple processes, the service manager process, and the clients can connect to that. A Unix socket netlayer would be useful for this and as a general-purpose tool.It's desied with introduction servers, one or moer of. These act to introduce multiple ocapn peers to each other if they share this server. We want this to get around of confused deputy issues that trick a process to follow a filesystem path that the coordinator has access to but maybe the clients don't. You would request access to a peer, and send an anonymous domain socket to that peer, which would then communicate back over the socket. I can provide a demo demonstrating this (shares scren)

JessicaTallon: I'm running the process with one of these introduction servers. And then I'm using goblin chat. It's hard to demo a netlayer, but I want to show it so you can see that it's working. You use an ocapn netlayer sturdyref and share it with Bob and Carol, and then I get these windows opening with chats. There's third-party handoff happening under the hood, and as you can see it's very fast. Since it's only used for intros and not relays, I can kill the intro server and it all still wor V Very fast, very convenient for local things. I suspect no one has had a chance to look at it yet, but people can read the draft specification. Next month we can discuss it if people have time to read it by then.

KrisKowal: This is really neat, in that it continues without the daemon (intro server).

Christine: Do handoffs continue to work after you kill the daemon?

JessicaTallon: No

KrisKowal: But if you restore the daemon, handoffs continue working again?

Jesicca: You would have to re-handoff. But actually... I think this would work, because this was designed where each node and server have an identity (keypair), and the part of the hints are the public keys of all introduction servers you could reach, if all the peers reconnect after the server restarts, the peers should be able to ask for a new connection to each other, and then everything should work.

Christine: Jonathan dropped off because he can't hear audio, I forgot this happens, but this is why we don't use Jitsi.

Jonathan: (rejoins) I can hear agan.

Jonathan: Sorry, so where do we stand.

JessicaTallon: I propose that everyone looks at the PR, and we discuss it at the next meeting: https://github.com/ocapn/ocapn/pull/190

Christine: After you specify who you want to be introduced to, you can grab the handle to the socket off of the wire, is that right?

JessicaTallon: The ability to send sockets over Unix domain sockets to other processes is possible I realized in the implementation of this PR. You create a pair of sockets and send one of them to the introduction server, which forwards that socket to the peer, and the peers get a direct connection. You connect to the introduction server by whatever means you want, and the netlayer doesn't need filesystem access.

Christine: If you give an attenuated process a handle to the introduction server, all of this still works even if said process does not have filesystem access.

MarkM: In terms of threat model, what are the vulnerabilities to a bad intro server?

JessicaTallon: The bad intro server could put itself in the middle and see the traffic. A sends a socket to the intro server to pass on to B. The intro server could MITM the A -> B connection.

MarkM: The traffic is not e2ee for Unix domain sockets?

Christine: No, although once the introduction occurs, in the honest case, the introduction / handoff server disintermediates the connection.

MarkM: Let's go through some scenarious. In the case of A, B, C (standard case), if they are all on the same machine with an operating system providing domain sockets, if you ignore the outside world (beyond the machine), why is there an introduction service at all? If A has a domain socket to B and C (separately), A can pass... I'm sorry, I mean the vats, A can just do the VatTP-level intro by passing her Unix domain socket... Oh, you don't want the same socket.

KrisKowal: Yes, and in that particular design, everyone has to trust everyone else.

MarkM: Is this true? I'm confused about Unix domain sockets. If I pass a socket, am I passing a live connection?

JessicaTallon: Yes, a socket file handle that's live.

Christine: Notably not a reliable mechanism to identify whether two connections are the same.

KrisKowal: You can verify the equivalence of two sockets, but you can't divide a single socket such that you're not vulnerable.

JessicaTallon You do have to trust the intro server entirely. I refer to them as "god processes", because you do have to give them alot of trust.

MarkM: If you're doing e2ee as you would between machines, the vulnerability to the intro server would not include eavesdropping our integirty.

JessicaTallon Yes... It could be that we want to layer encryption on top. It cuold be that we should be doing that. I would be interested in your thoughts Mark.

KrisKowal: I think if you do that, I think you can get to the point where you are not more vulnerable to the intro server than you are to another netlayer on the network.

C: You still probably can't avoid monitoring attacks. You can't avoid monitor that messages are sent at certain times.

MarkM: Yes, that's right. We're left with the same vulns as those between two mutually distrustful machines.

KrisKowal: Even adding encryption, you cannot remove the intro server. Because you still need to guarantee that there's a single connection between two peers.

MarkM: Because passing a socket is passing an existing connection, which I'm a bit surprised by btw, because I understand that domain sockets are not a capability system at the connection layer, and therefore I can understand why you want introduction _services_, there doesn't need to be one, just one in common for those who want to connect

JessicaTallon I think they are capability system. I spent quite a long time trying to remoev the intro server from the equation,  and that's partially why we try to establish equivalence between de-references, i.e. two nodes can verify that... The reason you want an intro server is because (1) you want the initial connect, and (2), generally speaking, for all other netlayers, you've been able to use sturdyrefs to reconnect. You've had a way of sharing them out-of-band. If you can get a sturdyref, you want to be able to enliven it. Without an intro server, you can't really do that.

MarkM: Does the sturdyref contain the pubkey or fingerprint of the peer it designates?

JessicaTallon In #190, the locator that I defined (the peer locator), contains the pubkey of the peer, and, in the hints, all of the pubkeys of the introduction servers that it's connected to. If that's sent out of band, it knows whether there's a difference between the set of connected intro server.

MarkM: I love that you're doing redundant intro servers in the hints. It's easy to miss the need for that.
Since you have the pubkeys, if you use that to do e2ee, that would solve your "eek" problem. You don't need to know that the connection is the same, if you have the public key, you can just reuse that connection, you don't need to create a new connection for it.

JessicaTallon That works for new outgoing, but not necessarily for incoming connections, because the intro server tells you what that key is.

MarkM: Just one more before I yield. What if vat A is on a separate machine, and B and C both share the same domain socket introducer. If A introdues B to C, A doesn't share the introducer, do B and C end up with a direct connection in this case?

JessicaTallon I'm struggling to figure out this scenario. If A is on a spearate machine, domain sockets wouldn't apply.

Jonathan: Kris is on the queue twice.

KrisKowal: Really just once. Am I right that bootstrapping the introduction server itself requires opening a socket in a named position on the file system?

JessicaTallon Not necessarily, I think. I think you can pass in a file descriptor to a process when you start it, and in that case you don't need to.

KrisKowal: Yes, but the provenance of that file starts at the file system, so you need a file to bootstrap. Something needs to open the file, if I'm correct.

Christine: it doesn't have to be the process itself

KrisKowal: Yes for sure, which is to say you can be on a multi-tenant system were all users can be sure that noly the super user can open the file.

Christine: Falling back on an ACL?

KrisKowal: I think you're forced to modern architectures

MarkM: You're talking about those legacy "ackle" systems

KrisKowal: Ah yes. What are the hints for the introduction servers?

JessicaTallon They have a keypair and the hints are the public keys of all the intro servers you can be reached on.

Jonathan: Christine is on queue if that's ok

Christine: I concede. I was just going to say that there's a challenge where if you try to introduce it to only encryption, you can reduce it to encryption itself, you can do a side-table of capabilities... but I suppose if it is a side-table to nodes/machines/ peers, it can be fine, as long as you're able to handoff to an object directly without requiring the certificates. That's not what we're doing thought right? It uses normal handoff?

JessicaTallon Yes

Christine: I cede my point, encryption should be fine except for network monitoring / interference. As Mark pointed out, effectively the same vulnerabilitise as between mutually suspicious machines

KrisKowal: IMO that's beneath the irreducible threat model of running on a system

Christine: More serious than that, because you don't have to be a super user to create a domain socket.

KrisKowal: I think the problem can be eliminated by putting more responsibilities in the intro server

Christine: I'm talking about the case of no intro server, if you could eliminate them... Even if you can protect against integrity via encryption, you can't protect against monitoring or opportunistic disconnects

KrisKowal: Right, our position is the same. IMO if you trust your kernel, you can trust...

Christine: Basically, you treat the intro server as part of your TCB, part of your kernel.

KrisKowal: Yeah, you can't do better than that... If the bootstrapping server where in a home directory, it would not be a safe place to stand in a multi-tenant system, but that's a solvable problem

Jonathan: I think we can go on to the next item. #168? Unless there's more to cover.

MarkM: I want to express extreme discomfort, which is slightly below objecting, to the idea of treating the intro server as part of the TCB, which implies willingness to accept full vulnerability to it. I would still like to see e2ee. I would also like to see, re: incoming connections being preferred, I want us to keep our eyes on the crossed hellos problem.

JessicaTallon There is a solution to crossed solutions in captp, so in the layer above.

MarkM: Okay!

Christine: Mark btw Jessica and I both do not object to e2ee. The only objection I can foresee is that, part of the Unix domain socket netlayer goals is for it to be very fast. Maybe the solution is two netlayers, one that you are fully vulnerable to, and one where you are not (via e2ee). Not pushing hard on this.

MarkM: Yeah, if the cost of e2ee is high, it's worth revisiting it. But let's not prematurely optimize.

JessicaTallon I agree, we should do our best to not fully trust the intro server as much as we currently do in #190. Christine and Julie pushed back on that quite a bit, and I'm keen to see us reduce our trust in it.

## [#168](https://github.com/ocapn/ocapn/issues/168): desc:import-answer issue/PR

Jonathan: Okay, can we move on? So, issue 168 is next.

KrisKowal: I'm ucnertain if we have the right people in the room for that issue.

Jonathan: We are also short on time.

KrisKowal: Down to 5

Jonathan: Any suggestions Jessica?

JessicaTallon Yeah, I'm fine to push until next meeting. I would like for Mark to provide an explanation as an issue comment or in the meeting. 

KrisKowal; Can you pose your question for Mark? My understanding is that, there's a tension currently that one of our objects, the bootstrap object, is in a weird position in that it's not transferrable, We can't 3PHO a bootstrap object. Is that right?

JessicaTallon I think you can hand off a bootstrap object. 

KrisKowal: Okay. I propose that we take it out of band to next month.

MarkM: Sorry I took up all the airtime. Jessica if you could let me know after the meeting what qusetion you would like me to answer, that would be helpful.

JessicaTallon You did reply briefly...

Christine: Should I just reinsert the thing into Mark's brain?

MarkM: Sure!

Christine: We have the ability to refer to imports and exports directly (kumavis brought to light), but we don't have a direct ability to refer to the result of a promise pipeline. I said that I used to be able think that we should do this, and then I remembered the motivation for four tables. The GC mechanism is different for desk answers vs. imports and exports, and we may ruin the GC properties for question and answer tables if we change it.

MarkM: In E captp--there's enough changes between E and ocapn that I'm not sure if it applies--

Christine: I'm not sure if the GC is different enough to make a difference

MarkM: The key thing is that the answer gets resolved to something other than an answer. Essentially, by the time a remote party wants to designate the answer... I'm actually not sure, I might have to read some E source code.

Christine: Maybe we need to do some internal review also. If you were able to refer to the desk answer, we wouldn't really need the different tables

MarkM: I can certainly explain why we need the different tables, but we're running out of time. I'm not sure if I have anything to say outside of the 4 tables article on erights.org

JessicaTallon I can also try to figure it out again in my head.

Erik: I have to drop.

Christine: Why don't we resume this?

Everyone: Yes, bye!

