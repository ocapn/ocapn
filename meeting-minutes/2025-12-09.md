# Attendees

- Christine Lemmer-Webber (Spritely)
- Jessica Tallon (Spritely)
- David Thompson (Spritely)
- Baldur (independent, E lorist)
- Kris Kowal (Agoric, Decentralized Cooperation Foundation)
- Kumavis (MetaMask)
- Richard Gibson (Agoric)
- Ridley (Dart implementation)

# Agenda

- Implementers working group - progress report
- Announce two new OCapN NLnet grants: Ridley's Dart grant and Jessica's e2ee relay grant
- Fix ocapn-peer field ordering and hints are structs #220
- Specify protections against multiple session to the same peer #221

- Fold op:deliver-only into op:deliver #202
- Change GC ops to take a list of positions #213

- The November agenda has a long list of issues demanding group attention. If you would like to annotate any as completed or moot, or if you want to nominate any for December meeting discussion, please do.
- E.g. lowest-numbered issue on November agenda: PR

- Propose TCP Testing Netlayer #104 TCP - review now complete - small decisions and text changes now required

- 3ph and 2 party simplified mode

# Minutes

JAR calls to order at 11:06 Pacific. (19:06 UTC)

## Implementers working group - progress report

JAR: Seeking volunteer to report on implementer working group.

Jessica: Can do. I [posted a link](https://github.com/ocapn/ocapn/issues/209). Kris Kowal and I have posted summaries most weeks we’ve attended, with bullets for the topics we discussed. I would say the overall impression was really good, at least from my perspective. We covered a lot of ground and have gotten the process of interop started, regarding issues and what not. To give a flavor of what we discussed, of the three we had. We spoke of the status of Ridley and Kumavis’s implementations. We’ve talked a lot about netlayers. We talked about an e2ee relay. We talked about Noise Protocol. We talked of the TCP netlayer and designators. We talked about WebSocket netlayer briefly.

- Store and Forward netlayer
- Sturdyrefs and how they are used
- Not much on WebRTC

Kumavis found some bugs in the test suite that caused issues for the Endo JS implementation. Some parts of the spec were underspecified. And some bugs in Goblins. That was really great. I love to see finding bugs because we can fix them.

That is most of what we discussed. Those were the big topics and were really helpful and good. Work towards interop is on the go.

Christine: The meetings have been productive. They have been productive because of the rule we established at the offset. The goal is interop. There are two requirements:

- You have to be contributing to an implementation
- You have to be up to speed on the spec

We are not as strict at the plenary meetings and we have been able to move more quickly with them in the interop implementer meetings.

JAR: Comments or questions on that?

Kris: One comment with regard to prior of what's discussed, we did discuss sturdyrefs, discovered that we have a weak understanding of the sturdyref and its role in the protocol and we should continue to discuss here or there

JAR: My question is whether the subgroup needs anything from the larger group. Sounds like not.

Ridley: From my perspective, is plenary should continue to process and keep moving forward.

JAR: I would like to move on with the agenda. I have a reference to issues we threw away last time. Nobody had anything to say, particularly regarding starting at the oldest issue. That sort of connects to what we talk about.

Christine: Do we want to go in Github or Cryptpad order

JAR: I can’t see the Cryptpad but I’m going from Github. Suggestions are welcome. What changes did you (Christine) make to the Cryptpad.

Christine: I just put the announcements.

JAR: I’m just looking at old business.

Christine: That’s fine.

JAR: I’m unclear whether there’s anything urgent for this meeting so we may as well skip to old business. Do we have interest in discussing #104? If there’s nobody who wants to we should move on to grants and PRs. I don’t have a good sense as a convener about what we need to be talking about. Any help would be great. I am going to skip #104.

Kris: It seems perfectly fine with going with old business

Christine: Sorry for making it hard on the chair. You’re doing a good job herding the cats.

Jessica: Christine voluntold me to… I was looking at the issue to review #104.

## Propose TCP Testing Netlayer #104 TCP - review now complete - small decisions and text changes now required

Jessica: Kris reviewed this and it’s back to plenary to discuss. Kris mentioned decoupling the encoding protocol from the CapTP protocol. It is currently very coupled, especially to 3pho certificates. Kris what is the best way forward. Should we decouple when can we decouple.

Kris: I'm a bit at a loss as for the right way forward. I see two options: we can decouple syrup completely from every layer of the protocol now, which would enable us to make consensus on interop early on presumption that syrup can be changed. I think we need to at least agree to decouple syrup to the extent we agree to change the protocol going forward. We need to be able to upgrade captp in flight. That's something we need to resolve before an interop target. For 3ph and other use of syrup and places where we're canonicalizing to sign them, not sure what to do about that. We need a canonical representation for signatures, since they're signed, and I don't think that's negotiable, I don't think we can frame captp where we can say signed messages encoding is negotiable in flight. We have options: for that one bc so tightly coupled, we have to either choose between what representation is, we can choose canonical repr and not have it be syrup, or we can defer interop target

Jessica: I am looking at where you commented on this PR, I see that only place you mentioned syrup is where it says messages are encoded in syrup. I guess an action point is that we can move that one line that all messages must be encoded in Syrup because that is the current concrete encoding, but I can certainly remove that one thing.

When we decided to proceed with Syrup we agreed that it could be changed later. I think that is still the case. I think it would be fine to agree to the format now and it is open to discuss it.

Kris: My thinking is we need to be able to credibly switch past syrup. And we need a way to move to interoperable mechanisms that can be deployed. Mechanisms I'm suggesting are layered. Layering starts with locator, locator is more permanent out for other branches. Designator could change in an ocapn netlayer without breaking compatibility because an implementation can do two netlayers. Within a netlayer, initial netlayer might not have flexibility of encoding. Migrating means moving protocols which means leaving grant matching (equality test) behind. Within (?) move towards multiple protocols. If netlayer specifies negotiation of changing mechanism. Particular peer is able to (?) to do encoding, ideally, that handshake is overlaid over cryptographic protocol so you can not have to suffer another 1.5 round trips to negotiate. But negotiating message encoding, I don't yet understand or see a way to decouple that from signing for 3 party handoff because signing for 3 party handoff transcends encoding for any particular peers because signing needs to be agreed across entire network so that I believe is the crux of it. We can either find a way to be flexible of that going forward by choosing a simpler not context-free way of signing messages and we can only credibly do that if the signed messages do not enclose over the entirety of the data model. And forgive me if I don't recall the specificity, but then we do not have an option to simplify signing encoding and signatures. I also don't know whether signing cryptography is necessary for 3 party handoff. I personally like design we have. And then... yeah apart from that I don't know what to do. The other option of course is we can agree early on the early encoding will be but that does delay interop on consensus that otherwise would be deferred.


Christine: Several observations

1. I think all these points are important, but it is packed and I would split it into many layers, not necessarily about the TCP netlayer. It is not a change in the state of affairs for TCP netlayer. We have agreed that we can revisit this part of the data model. Given that this could significantly help the test suite. Is this separable?
2. I do believe that there is a way to decouple the protocl, like with magic bytes. Arguably you could even treat the initial part of the message as the magic bytes. All messages start the same way initially.

I think those are two separate things. This is a lot to split out that is urgent but not necessarily for the TCP suite. (I am aware we are at the half hour mark)

JAR: My main concern is knowing what next steps are. Do we have people talking to each other?

Kris: Giving summary of 104 in hopes it can help concretely move forward. I've read the most recent comments. My response is: as long as for the purpose... there are two things in my comments much of which are not germane to the broader picture comments. One of which is decoupling, not the same one I was talking about ad-hoc, but decoupling message delimiter over TCP, but a thing I'd like and something I'd like to push for in context of specifying a TCP netlayer, effectively what is implemented requies streaming syrup, and requires streaming bytearrays, which I think is too complicated. Well, not too complicated. You can build a parser that notices when things are delimeted. With websocket you don't have to do that. With future is to provide largely websocket and something else... obligating a client to provide a streaming syrup implementation is not as bad if we provide an outer envelope. I believe it is more difficult to provide a javascript netlayer otherwise, I'll leave it to Kumavis to speak to that. But otherwise my prograstinations about forward compatibility are adequately satisfied by having the netlayer make it clear that it's disjoint for testing purposes.


JAR: So, we still have a structural question of who is doing something on this next? Are we looking for a volunteer or drafting you (Kris).

Kris: I am happy to write spectext saying that netlayer requires a netstring delimiter. In order to know whether it's the right thing to know I think we need to know that there's an additional requirement to provide a streaming syrup netlayer.

Kumavis: We do not have a streaming Syrup parser and it would be a significant rewrite (of the parser) to do it.

Christine: Syrup is largely netstring. Any time has an open delimiter where you know how to scan for the closing delimiter. We could wrap netstring but I am pretty sure that if you have a netstring parser I don’t think it’s much harder to do a streaming… I guess the difference. The streaming part is not off a fixed data structure and you’re pulling from a live open socket, where you’re reading as you go. This is what Dave’s asking. What’s the different in the parser? What I am hearing… Tell me if I have this correct. It’s relatively easy to read a netstring because you just buffer the initial characters, decimals before the colon. It is much more subtle to read Syrup off an open port, for reading data as opposed to a byte array.

Kris: Yes, and reading that in an asynchronous matter in Javascript is delicate and subtle and requires much more testing over a large amount of messages and asynchronous data. Doing that while simultaneously doing that over a context free grammar to know whether you're reading enough to throw off a chunk is another thing to deal with separately. For example if you're reading at a context which does not have a parser issue that requires reading from (?)

JAR: David took himself off the queue. I would like to wrap this up. We should have an issue we post to. If we have a decision, someone needs to volunteer to make a decision.

Christine: I have a question to follow up to see if I understand. Given that Syrup already contains… Most syrup implementations are probably not. I don’t know what your implementation is closer to netstring. There are parts that are close to netstring. Given that you have to read in based on a buffered number of digits. So, is it… This is a topic for the implementers meeting.

JAR: Sounds good to me.

Kris: Sound good to me.

JAR: That’s a decision. There’s considerable interest in talking about grants.

## Grants

Jessica: NLNet released a bunch of grants that they are going to be funding. There are two OCapN grant inside of that which is super exciting. They have funded my grants in the past. There are two more. One is mine from an application from Spritely to pursue an [E2EE relay netlayer](https://nlnet.nl/project/OCapN-federatedrelays/). Part of that is standardizing and part is implementing. We have at Spritely a relay netlayer that does not use encryption. So, this will be a federated, encrypted, relay netlayer that will be very exciting for browsers and things, which make p2p very difficult.

The second is [Ridley’s grant](https://nlnet.nl/project/OCapN-DART).

Ridley: I got a grant to work on a Dart implementation. Because it took six months to get a grant application, I got a lot done before getting the grant. NLNet has agreed to shift the scope to focus on stuff I need to do yet, and additional items I would need to do that were not in the grant. I am nearly feature complete. There are a few small things. I need to test against the test suite. I would like to release that soon. It might take me another month to get the code out there. I have a few pieces that need to be done. One is netlayers on which I have done little. I have a fake one I’m using right now. Another, probably the biggest is working with Dart’s static types, in an environment that is not statically typed on the wire, finding a good balance in reliability in a distributed system. That’s the part I need to work on. I’ll be releasing an example application to show people how to use the library and to interop. I will put together a small standard library of actors that people using my package will want to use.

## Open PRs

JAR: Thank you, the next two on the agenda are Pull Requests nominated by Jessica. Jessica, have you looked at these lately.

Jessica: I have looked, it’s the groups decision.

## [Fix ocapn-peer field ordering and hints are structs #220](https://github.com/ocapn/ocapn/pull/220)

The first is #220 which is much smaller than the other one. The difference in the test suite and the Goblins implementation. This is flipped. We are switching transport, designator, hints, and we propose to reverse designator, transport, hints. This brings the spec in line with the Goblins implementation.

The second # is changing hashmap to Struct with stringy keys and stringy values. It has received reviews. Dave and Kumavis won’t block it and the values should be strings only.

I am hoping we can just merge these.

JAR: It looks straight-forward. Any objections.

I see a merge button. Can I merge it? Jessica, you have been doing most of the spec work, you can merge it.

Jessica: Christine says do it Jonathan!

## [Specify protections against multiple session to the same peer #221](https://github.com/ocapn/ocapn/pull/221)

Jessica: I don’t know if anyone wants more time for the second issue. The test suite was not good about cleaning up all the sessions in the 3PHO test cases and that uncovered the fact that Goblins actually allows multiple incoming connections for the same pair of peers, which should never happen in OCapN. There is machinery to stop it from happening. The test suite was causing it to happen. Kumavis’s Endo implementation was correctly failing.

This spec change came out of a discussion in the implementers group. If you receive a connection from a peer you already have a connection, you should abort it. It also specifies what an implementation should do if it receives `op:start-session` from another session.  You should not have duplicates. This calls out that you should abort such a session. Crossed-hellos were under-specified. The implementation pointed to the spec, and if you tried to do that, you would find it grossly unspecified. This expands that and hopefully provides plenty of information on how to promptly change crossed hellos ~~mitigation~~ resolution.

I encouraged feedback for folks to comment on whether the issue is addressed to their satisfaction.

I would find it fine to shunt to next month’s meeting so folks have time to review it.

JAR: I will put this at the top of old business.

Kris: Sounds good to me.

JAR: We have two issues from Ridley that should have a quick discussion.

# Change GC ops to take a list of positions #213

Ridley: Sure, #213, I’ve already talked to Spritely and they seemed on board. They can obviously change their minds. As I was implementing GC, I noticed that I was taking a list of identifiers and sending separate op:gc messages for each of them and that seems unnecessary. I propose we send a list instead of a single, albeit a list of a single, so you don’t have to send a lot of GC messages if you have a lot of objects that need GC.

Kris: This sounds good to me.

JAR: What is needed to continue work.

Ridley: If there is no objection, I can make a pull request.

JAR: I hear no objection, turning to the queue.

David Thompson: +1 I support this change.

Jessica: Is this specifically for op:gc-answer or op:gc-export?

Ridley: I realized that op:gc-export needs two lists with the position number and the wire delta. So, if we allow a multiple object GC, we need the respective positions of position number and wire deltas. I propose to do this with two lists, and walk them index by index. That’s my proposal.

Christine: +1 and two lists is fine. All the cats are in a row, good news for the chair.

JAR: We’ve quickly gone over those two issues. Ridley, are you satisfied.

Ridley: It will take some time and I will have something by next meeting.

JAR: I’m happy to close now.

*crickets*

Kumavis: Did we identify merge requirements for #221? Like, now, or when all current reviewers approve.

Ridley: I have no objection, but I have not read it so I don’t know what I would agree to.

Kumavis: We probably don’t need another month.

Ridley: 

Christine: I experimentally defer to the chair. If there continues to be consensus from a member who says they need review, can we merge without another round of plenary?

JAR: I’m okay with agreeing to merge if the three reviewers are satisfied, given there’s been no contentions discussion.

Christine: I propose we get rough consensus out of band and running test suites and rubber stamp at the next plenary meeting.

JAR: Meeting is over.

Christine: This was a productive meeting. Thanks to Jonathan for running and thanks Kris for scribing.

Ridley: Bye everyone.
